import{j as k,aq as T,k as f,am as q,l as V,f as g,ar as P,as as S,_ as D,c as E,o as I,w as c,b as u,a as t,Z as v,t as y,Q as N,e as O,aa as j,d as z}from"./index-DplQUD0A.js";import{Q as F,a as L}from"./QPopupProxy-C1b_y5o1.js";import{Q as U,a as B}from"./QTable-CnBEjsvz.js";import{a as W}from"./QList-DXWnYqAZ.js";import{Q as G}from"./QSpinnerDots-Bv5nZoMY.js";import{Q as M}from"./QInnerLoading-pT5z-x46.js";import{Q as R}from"./QPage-DmXXCfK5.js";import"./use-render-cache-DLxPkVnQ.js";import"./format-0tEX_y_u.js";import"./selection-Dlqk-rqy.js";import"./QMarkupTable-Db7r1ob3.js";import"./QSelect-CGr-2Avp.js";import"./QChip-kZlg-3mS.js";import"./QItem-bnHiAGxq.js";import"./QItemLabel-Di6HfrnL.js";import"./use-fullscreen-BN0U0hDi.js";const Z=k({name:"QBtnToggle",props:{...T,modelValue:{required:!0},options:{type:Array,required:!0,validator:e=>e.every(a=>("label"in a||"icon"in a||"slot"in a)&&"value"in a)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(e,{slots:a,emit:l}){const w=f(()=>e.options.find(i=>i.value===e.modelValue)!==void 0),o=f(()=>({type:"hidden",name:e.name,value:e.modelValue})),m=P(o),s=f(()=>q(e)),p=f(()=>({rounded:e.rounded,dense:e.dense,...s.value})),C=f(()=>e.options.map((i,d)=>{const{attrs:b,value:h,slot:_,...n}=i;return{slot:_,props:{key:d,"aria-pressed":h===e.modelValue?"true":"false",...b,...n,...p.value,disable:e.disable===!0||n.disable===!0,color:h===e.modelValue?r(n,"toggleColor"):r(n,"color"),textColor:h===e.modelValue?r(n,"toggleTextColor"):r(n,"textColor"),noCaps:r(n,"noCaps")===!0,noWrap:r(n,"noWrap")===!0,size:r(n,"size"),padding:r(n,"padding"),ripple:r(n,"ripple"),stack:r(n,"stack")===!0,stretch:r(n,"stretch")===!0,onClick(x){A(h,i,x)}}}}));function A(i,d,b){e.readonly!==!0&&(e.modelValue===i?e.clearable===!0&&(l("update:modelValue",null,null),l("clear")):l("update:modelValue",i,d),l("click",b))}function r(i,d){return i[d]===void 0?e[d]:i[d]}function Q(){const i=C.value.map(d=>V(g,d.props,d.slot!==void 0?a[d.slot]:void 0));return e.name!==void 0&&e.disable!==!0&&w.value===!0&&m(i,"push"),S(a.default,i)}return()=>V(W,{class:"q-btn-toggle",...s.value,rounded:e.rounded,stretch:e.stretch,glossy:e.glossy,spread:e.spread},Q)}}),H={name:"AsistenciaPage",data(){const e=new Date().toISOString().slice(0,10);return{hoy:e,fecha:e,asignacion:null,loading:!0,saving:!1,asistencias:{},columns:[{name:"nro",label:"#",field:"__nro",align:"left"},{name:"nombre",label:"Nombre",field:"nombre",align:"left"},{name:"ci",label:"CI",field:"ci",align:"left"},{name:"asistencia",label:"Asistencia",field:"__a",align:"left"}],opciones:[{label:"P",value:"Presente"},{label:"T",value:"Tarde"},{label:"A",value:"Ausente"},{label:"L",value:"Licencia"}]}},computed:{rowsEstudiantes(){const e=this.asignacion?.estudiantes;return Array.isArray(e)?e:[]}},watch:{fecha(){this.cargarAsistencias()}},async mounted(){await this.cargarAsignacion(),await this.cargarAsistencias()},methods:{async cargarAsignacion(){this.loading=!0;try{const e=this.$route.params.id,{data:a}=await this.$axios.get(`/asignaciones/${e}`,{params:{with_estudiantes:!0}});this.asignacion={...a,estudiantes:Array.isArray(a.estudiantes)?a.estudiantes:[]},this.asignacion.estudiantes.forEach(l=>{this.asistencias[l.id]||(this.asistencias[l.id]="Presente")})}catch{this.$alert.error("No se pudo cargar el curso")}finally{this.loading=!1}},async cargarAsistencias(){if(!(!this.asignacion?.id||!this.fecha)){this.loading=!0;try{const{data:e}=await this.$axios.get("/asistencias",{params:{asignacion_id:this.asignacion.id,fecha:this.fecha}}),a=e.items||{};this.asignacion.estudiantes.forEach(l=>{this.asistencias[l.id]=a[l.id]||this.asistencias[l.id]||"Presente"})}catch{}finally{this.loading=!1}}},marcarTodos(e){this.rowsEstudiantes.forEach(a=>{this.asistencias[a.id]=e})},async guardar(){if(!(!this.asignacion?.id||!this.fecha)){this.saving=!0;try{const e=this.rowsEstudiantes.map(a=>({estudiante_id:a.id,asistencia:this.asistencias[a.id]||"Presente"}));await this.$axios.post("/asistencias",{asignacion_id:this.asignacion.id,fecha:this.fecha,items:e}),this.$alert.success("Asistencias guardadas")}catch(e){this.$alert.error(e.response?.data?.message||"No se pudo guardar la asistencia")}finally{this.saving=!1}}}}},J={class:"row items-center q-mb-md"},K={class:"col"},X={class:"text-caption text-grey-7"},Y={class:"col-auto q-gutter-sm"},$={class:"col-12 col-md-3"},ee={class:"col-12 col-md-6"},ae={class:"col-12 col-md-3 text-right"};function se(e,a,l,w,o,m){return I(),E(R,{class:"q-pa-md"},{default:c(()=>[u("div",J,[u("div",K,[a[8]||(a[8]=u("div",{class:"text-h5 text-bold"},"Asistencia",-1)),u("div",X,[a[6]||(a[6]=v(" Curso: ")),u("b",null,y(o.asignacion?.curso?.nombre||"-"),1),a[7]||(a[7]=v(" â€¢ Docente: ")),u("b",null,y(o.asignacion?.docente?.nombre||"-"),1)])]),u("div",Y,[t(g,{flat:"",icon:"arrow_back",label:"Volver","no-caps":"",onClick:a[0]||(a[0]=s=>e.$router.push("/curso/"+e.$route.params.id))})])]),t(N,{flat:"",bordered:"",class:"q-mb-md"},{default:c(()=>[t(O,{class:"row q-col-gutter-md items-center"},{default:c(()=>[u("div",$,[t(j,{modelValue:o.fecha,"onUpdate:modelValue":a[2]||(a[2]=s=>o.fecha=s),label:"Fecha",dense:"",outlined:"",mask:"date",rules:[s=>!!s||"Requerido"]},{prepend:c(()=>[t(z,{name:"event"})]),default:c(()=>[t(F,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[t(L,{modelValue:o.fecha,"onUpdate:modelValue":a[1]||(a[1]=s=>o.fecha=s),options:s=>s<=o.hoy},null,8,["modelValue","options"])]),_:1})]),_:1},8,["modelValue","rules"])]),u("div",ee,[t(g,{outline:"",color:"primary",label:"Marcar todos: Presente",dense:"",onClick:a[3]||(a[3]=s=>m.marcarTodos("Presente")),class:"q-mr-sm"}),t(g,{outline:"",color:"warning",label:"Todos: Tarde",dense:"",onClick:a[4]||(a[4]=s=>m.marcarTodos("Tarde")),class:"q-mr-sm"}),t(g,{outline:"",color:"negative",label:"Todos: Ausente",dense:"",onClick:a[5]||(a[5]=s=>m.marcarTodos("Ausente"))})]),u("div",ae,[t(g,{color:"primary",icon:"save",label:"Guardar",loading:o.saving,onClick:m.guardar},null,8,["loading","onClick"])])]),_:1})]),_:1}),t(U,{rows:m.rowsEstudiantes,columns:o.columns,"row-key":"id",flat:"",bordered:"",dense:"","rows-per-page-options":[0],title:"Lista de Estudiantes"},{"body-cell-nro":c(s=>[t(B,{props:s},{default:c(()=>[v(y(s.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-asistencia":c(s=>[t(B,{props:s,class:"q-pa-xs"},{default:c(()=>[t(Z,{modelValue:o.asistencias[s.row.id],"onUpdate:modelValue":p=>o.asistencias[s.row.id]=p,options:o.opciones,rounded:"",unelevated:"",dense:"","toggle-color":"primary"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),t(M,{showing:o.loading},{default:c(()=>[t(G,{size:"32px"})]),_:1},8,["showing"])]),_:1})}const ye=D(H,[["render",se]]);export{ye as default};
