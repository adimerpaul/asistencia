import{_ as q,c as n,o as i,w as o,a as s,a0 as A,d as p,W as g,Z as c,f as u,aa as h,h as V,Q as y,e as b,b as f,t as _,a1 as E,a2 as G}from"./index-DplQUD0A.js";import{Q as v,a as m}from"./QItem-bnHiAGxq.js";import{Q as C}from"./QItemLabel-Di6HfrnL.js";import{Q as N}from"./QList-DXWnYqAZ.js";import{Q as I,C as w}from"./ClosePopup-bTjcYP3V.js";import{Q as z,a as D}from"./QTable-CnBEjsvz.js";import{Q as S}from"./QChip-kZlg-3mS.js";import{Q as B}from"./QImg-C_KWN90v.js";import{Q as x}from"./QSpace-B83tlm_Y.js";import{Q as U}from"./QSelect-CGr-2Avp.js";import{Q as P}from"./QForm-8hFc4Yrq.js";import{Q as F}from"./QPage-DmXXCfK5.js";import"./moment-C5S46NFB.js";import"./format-0tEX_y_u.js";import"./selection-Dlqk-rqy.js";import"./QMarkupTable-Db7r1ob3.js";import"./use-fullscreen-BN0U0hDi.js";const T={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionUser:"",gestiones:[],filter:"",roles:["Administrador","Docente","Estudiante"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"avatar",label:"Avatar",align:"left",field:a=>a.avatar},{name:"role",label:"Rol",align:"left",field:"role"},{name:"docente",label:"Docente",align:"left",field:a=>a.docente?.nombre}],permissions:[],dialogPermisos:!1,cambioAvatarDialogo:!1,docentes:[]}},async mounted(){this.docentes=await this.$axios.get("docentes").then(a=>a.data),this.usersGet()},methods:{onFileChange(a){const e=a.target.files[0],d=new FormData;d.append("avatar",e),this.loading=!0,this.$axios.post(this.user.id+"/avatar",d,{headers:{"Content-Type":"multipart/form-data"}}).then(k=>{this.cambioAvatarDialogo=!1,this.$alert.success("Avatar actualizado"),this.usersGet()}).catch(k=>{this.$alert.error(k.response.data.message)}).finally(()=>{this.loading=!1})},cambiarAvatar(a){this.cambioAvatarDialogo=!0,this.user={...a}},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Estudiante"},this.actionUser="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.users=[],this.$axios.get("users").then(a=>{this.users=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(a=>{this.userDialog=!1,this.$alert.success("User creado"),this.usersGet()}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("User actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},permisosShow(a){this.dialogPermisos=!0,this.user={...a},this.permissions.forEach(e=>{e.checked=a.userPermisos.some(d=>d.permisoId===e.id)})},userEditPassword(a){this.user={...a},this.$alert.dialogPrompt("Nueva contraseña","Ingrese la nueva contraseña","password").onOk(e=>{this.$axios.put("updatePassword/"+a.id,{newPassword:e}).then(d=>{this.usersGet(),this.$alert.success("Contraseña actualizada de "+a.username)}).catch(d=>{this.$alert.error(d.response.data.message)})})},userEdit(a){this.user={...a},this.actionUser="Editar",this.userDialog=!0},userDelete(a){this.$alert.dialog("¿Desea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+a).then(e=>{this.usersGet(),this.$alert.success("User eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},O={class:"text-right"},L={style:{position:"relative",top:"0",left:"0"}},R=["src"],W={class:"text-right"};function Z(a,e,d,k,t,r){return i(),n(F,{class:"q-pa-md"},{default:o(()=>[s(z,{rows:t.users,columns:t.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:t.filter},{"top-right":o(()=>[s(u,{color:"positive",label:"Nuevo",onClick:r.userNew,"no-caps":"",icon:"add_circle_outline",loading:t.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),s(u,{color:"primary",label:"Actualizar",onClick:r.usersGet,"no-caps":"",icon:"refresh",loading:t.loading},null,8,["onClick","loading"]),s(h,{modelValue:t.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>t.filter=l),label:"Buscar",dense:"",outlined:""},{append:o(()=>[s(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":o(l=>[s(D,{props:l},{default:o(()=>[s(I,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:o(()=>[s(N,null,{default:o(()=>[g((i(),n(v,{clickable:"",onClick:Q=>r.userEdit(l.row)},{default:o(()=>[s(m,{avatar:""},{default:o(()=>[s(p,{name:"edit"})]),_:1}),s(m,null,{default:o(()=>[s(C,null,{default:o(()=>e[16]||(e[16]=[c("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),g((i(),n(v,{clickable:"",onClick:Q=>r.userDelete(l.row.id)},{default:o(()=>[s(m,{avatar:""},{default:o(()=>[s(p,{name:"delete"})]),_:1}),s(m,null,{default:o(()=>[s(C,null,{default:o(()=>e[17]||(e[17]=[c("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),g((i(),n(v,{clickable:"",onClick:Q=>r.userEditPassword(l.row)},{default:o(()=>[s(m,{avatar:""},{default:o(()=>[s(p,{name:"lock_reset"})]),_:1}),s(m,null,{default:o(()=>[s(C,null,{default:o(()=>e[18]||(e[18]=[c("Cambiar contraseña")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),g((i(),n(v,{clickable:"",onClick:Q=>r.cambiarAvatar(l.row)},{default:o(()=>[s(m,{avatar:""},{default:o(()=>[s(p,{name:"image"})]),_:1}),s(m,null,{default:o(()=>[s(C,null,{default:o(()=>e[19]||(e[19]=[c("Cambiar avatar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":o(l=>[s(D,{props:l},{default:o(()=>[s(S,{label:l.row.role,color:a.$filters.color(l.row.role),"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-avatar":o(l=>[s(D,{props:l},{default:o(()=>[s(A,{rounded:""},{default:o(()=>[l.row.avatar?(i(),n(B,{key:0,src:`${a.$url}/../images/${l.row.avatar}`,width:"40px",height:"40px"},null,8,["src"])):(i(),n(p,{key:1,name:"person",size:"40px"}))]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(V,{modelValue:t.userDialog,"onUpdate:modelValue":e[9]||(e[9]=l=>t.userDialog=l),persistent:""},{default:o(()=>[s(y,{style:{width:"400px"}},{default:o(()=>[s(b,{class:"q-pb-none row items-center"},{default:o(()=>[f("div",null,_(t.actionUser)+" user ",1),s(x),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[1]||(e[1]=l=>t.userDialog=!1)})]),_:1}),s(b,{class:"q-pt-none"},{default:o(()=>[s(P,{onSubmit:e[8]||(e[8]=l=>t.user.id?r.userPut():r.userPost())},{default:o(()=>[s(h,{modelValue:t.user.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(h,{modelValue:t.user.username,"onUpdate:modelValue":e[3]||(e[3]=l=>t.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),t.user.id?E("",!0):(i(),n(h,{key:0,modelValue:t.user.password,"onUpdate:modelValue":e[4]||(e[4]=l=>t.user.password=l),label:"Contraseña",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])),s(U,{modelValue:t.user.role,"onUpdate:modelValue":e[5]||(e[5]=l=>t.user.role=l),label:"Rol",dense:"",outlined:"",options:t.roles,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),s(U,{modelValue:t.user.docente_id,"onUpdate:modelValue":e[6]||(e[6]=l=>t.user.docente_id=l),label:"Docente",dense:"",outlined:"",options:t.docentes,"option-label":"nombre","option-value":"id","emit-value":"","map-options":"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),f("div",O,[s(u,{color:"negative",label:"Cancelar",onClick:e[7]||(e[7]=l=>t.userDialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:t.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(V,{modelValue:t.cambioAvatarDialogo,"onUpdate:modelValue":e[15]||(e[15]=l=>t.cambioAvatarDialogo=l),persistent:""},{default:o(()=>[s(y,null,{default:o(()=>[s(b,{class:"q-pb-none row items-center text-bold"},{default:o(()=>[e[20]||(e[20]=c(" Cambiar avatar ")),s(x),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[10]||(e[10]=l=>t.cambioAvatarDialogo=!1)})]),_:1}),s(b,{class:"q-pt-none"},{default:o(()=>[s(P,{onSubmit:e[14]||(e[14]=l=>r.userPut())},{default:o(()=>[f("div",null,[f("div",L,[s(u,{icon:"edit",size:"10px",class:"absolute q-mt-sm q-ml-sm",onClick:e[11]||(e[11]=l=>a.$refs.fileInput.click()),dense:"",outline:"",label:"Cambiar foto","no-caps":""})]),t.user.avatar?(i(),G("img",{key:0,src:`${a.$url}/../images/${t.user.avatar}`,width:"300px",height:"300px"},null,8,R)):(i(),n(p,{key:1,name:"person",size:"100px"})),f("input",{ref:"fileInput",type:"file",style:{display:"none"},onChange:e[12]||(e[12]=(...l)=>r.onFileChange&&r.onFileChange(...l)),accept:"image/*"},null,544)]),f("div",W,[s(u,{color:"negative",label:"Cancelar",onClick:e[13]||(e[13]=l=>t.cambioAvatarDialogo=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:t.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ue=q(T,[["render",Z]]);export{ue as default};
