import{_ as q,c as p,o as d,w as a,b as e,a2 as h,a as s,f as k,W as b,d as g,Z as u,Q as y,e as w,t as l,a1 as C,a3 as R,a4 as N,aa as Q}from"./index-EGOOqB6t.js";import{Q as _,a as m}from"./QItem-DMn4-oxT.js";import{Q as E}from"./QList-DPAfQxpX.js";import{Q as D,C as x}from"./ClosePopup-CvDZ5KZb.js";import{Q as B}from"./QSpinnerDots-DzKE_UBK.js";import{Q as A}from"./QBadge-BKhDdCeE.js";import{Q as T}from"./QSpace-BjHnoaBj.js";import{Q as V}from"./QMarkupTable-CvVlghvR.js";import{Q as S,a as I}from"./QPopupProxy-Ckpi09eE.js";import{Q as P}from"./QPage-C5F9CDEc.js";import"./format-DjJwSxSa.js";import"./selection-oS81-IGS.js";import"./use-render-cache-DLxPkVnQ.js";const Y={name:"DetalleCursoPage",data(){return{asignacion:null,loading:!0,loadingNotas:!1,notas:{},loadingResumen:!1,resumen:{},desde:null,hasta:null}},computed:{rowsEstudiantes(){const o=this.asignacion?.estudiantes;return Array.isArray(o)?o:[]}},async mounted(){await this.obtenerDetalle(),await Promise.all([this.cargarNotas(),this.cargarResumen()])},methods:{scrollToNotas(){const o=this.$refs.cardNotas?.$el||this.$refs.cardNotas;o&&o.scrollIntoView&&o.scrollIntoView({behavior:"smooth",block:"start"})},openReporte(o){const t=this.$route.params.id,c=this.$axios.defaults.baseURL;if(o==="registro"&&window.open(`${c}/asignaciones/${t}/reporte-evaluaciones`,"_blank"),o==="notas"&&window.open(`${c}/asignaciones/${t}/reporte-notas`,"_blank"),o==="asistencia"){const f=new URLSearchParams;this.desde&&f.append("desde",this.desde),this.hasta&&f.append("hasta",this.hasta);const n=f.toString()?`?${f.toString()}`:"";window.open(`${c}/asignaciones/${t}/reporte-asistencia${n}`,"_blank")}},normalizar(o){return!o||typeof o!="object"?{curso:{},docente:{},estudiantes:[]}:{...o,curso:o.curso||{},docente:o.docente||{},estudiantes:Array.isArray(o.estudiantes)?o.estudiantes:[]}},obtenerDetalle(){return this.loading=!0,this.$axios.get(`/asignaciones/${this.$route.params.id}`,{params:{with_estudiantes:!0}}).then(o=>{this.asignacion=this.normalizar(o.data)}).catch(()=>{this.asignacion=this.normalizar(null),this.$alert.error("Error al obtener datos del curso")}).finally(()=>{this.loading=!1})},async cargarNotas(){this.loadingNotas=!0;try{const{data:o}=await this.$axios.get("/notas",{params:{asignacion_id:this.$route.params.id}}),t=o?.items??o??[];if(Array.isArray(t)){const c={};t.forEach(f=>{f?.estudiante_id&&(c[f.estudiante_id]=f)}),this.notas=c}else this.notas=t||{}}catch{this.$alert.error("No se pudieron cargar las notas")}finally{this.loadingNotas=!1}},nota(o,t){const c=this.notas[o]||{};return Number.isFinite(+c[t])?+c[t]:0},totalNota(o){const t=this.notas[o]||{},c=+(t.ser||0)+ +(t.saber||0)+ +(t.hacer||0)+ +(t.decidir||0);return Number.isFinite(c)?c:0},cargarResumen(){if(this.$route.params.id)return this.loadingResumen=!0,this.$axios.get("/asistencias/resumen",{params:{asignacion_id:this.$route.params.id,desde:this.desde||void 0,hasta:this.hasta||void 0}}).then(o=>{this.resumen=o.data.items||{}}).catch(()=>{this.$alert.error("No se pudo cargar el resumen de asistencia")}).finally(()=>{this.loadingResumen=!1})}}},U={class:"row items-center q-mb-md"},L={class:"col-auto q-gutter-sm"},z={key:0,class:"flex flex-center"},F={key:1},M={class:"text-h6"},H={class:"text-subtitle2"},j={class:"q-mt-sm"},G={class:"text-caption q-mt-sm"},O={key:0},W={colspan:"7",class:"text-grey-7"},Z={class:"text-right"},J={class:"text-right"},K={class:"text-right"},X={class:"text-right"},$={class:"text-right text-weight-medium"},tt={class:"col-12 col-md-3"},et={class:"col-12 col-md-3"},st={class:"col-12 col-md-3"},at={key:0},ot={colspan:"9",class:"text-grey-7"},it={class:"text-right"},nt={class:"text-right"},lt={class:"text-right"},rt={class:"text-right"},dt={class:"text-right"},ut={class:"text-right"};function ct(o,t,c,f,n,r){return d(),p(P,{class:"q-pa-md"},{default:a(()=>[e("div",U,[t[16]||(t[16]=e("div",{class:"col"},[e("div",{class:"text-h5 text-bold text-primary"},"Detalle del Curso")],-1)),e("div",L,[s(k,{flat:"",icon:"arrow_back",label:"Volver","no-caps":"",onClick:t[0]||(t[0]=i=>o.$router.back())}),s(D,{color:"primary",outline:"",icon:"manage_accounts",label:"Acciones","no-caps":""},{default:a(()=>[s(E,null,{default:a(()=>[b((d(),p(_,{clickable:"",onClick:t[1]||(t[1]=i=>o.$router.push(`/curso/${o.$route.params.id}/asistencia`))},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"how_to_reg"})]),_:1}),s(m,null,{default:a(()=>t[10]||(t[10]=[u("Tomar asistencia")])),_:1})]),_:1})),[[x]]),b((d(),p(_,{clickable:"",onClick:t[2]||(t[2]=i=>o.$router.push(`/curso/${o.$route.params.id}/notas`))},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"edit_note"})]),_:1}),s(m,null,{default:a(()=>t[11]||(t[11]=[u("Editar notas")])),_:1})]),_:1})),[[x]]),b((d(),p(_,{clickable:"",onClick:r.scrollToNotas},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"grading"})]),_:1}),s(m,null,{default:a(()=>t[12]||(t[12]=[u("Ir a notas")])),_:1})]),_:1},8,["onClick"])),[[x]])]),_:1})]),_:1}),s(D,{color:"primary",icon:"picture_as_pdf",label:"Reportes","no-caps":"",disable:!n.asignacion},{default:a(()=>[s(E,null,{default:a(()=>[b((d(),p(_,{clickable:"",onClick:t[3]||(t[3]=i=>r.openReporte("registro"))},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"table_chart"})]),_:1}),s(m,null,{default:a(()=>t[13]||(t[13]=[u("Registro (E1..E12)")])),_:1})]),_:1})),[[x]]),b((d(),p(_,{clickable:"",onClick:t[4]||(t[4]=i=>r.openReporte("notas"))},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"grading"})]),_:1}),s(m,null,{default:a(()=>t[14]||(t[14]=[u("Notas (SER/SABER/HACER/DECIDIR)")])),_:1})]),_:1})),[[x]]),b((d(),p(_,{clickable:"",onClick:t[5]||(t[5]=i=>r.openReporte("asistencia"))},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(g,{name:"event_available"})]),_:1}),s(m,null,{default:a(()=>t[15]||(t[15]=[u("Asistencia")])),_:1})]),_:1})),[[x]])]),_:1})]),_:1},8,["disable"])])]),n.loading?(d(),h("div",z,[s(B,{color:"primary",size:"40px"})])):(d(),h("div",F,[s(y,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(w,null,{default:a(()=>[e("div",M,l(n.asignacion?.curso?.nombre),1),e("div",H,l(n.asignacion?.curso?.descripcion),1),e("div",j,[s(A,{color:"orange",outline:"",class:"q-mr-sm"},{default:a(()=>[u("Formación: "+l(n.asignacion?.curso?.formacion),1)]),_:1}),s(A,{color:"teal",outline:""},{default:a(()=>[u("Tipo: "+l(n.asignacion?.curso?.tipo),1)]),_:1})]),e("div",G,[t[17]||(t[17]=u(" Unidad Educativa: ")),e("strong",null,l(n.asignacion?.unidadEducativa),1),t[18]||(t[18]=u(" | Gestión: ")),e("strong",null,l(n.asignacion?.gestion),1),t[19]||(t[19]=u(" | Año: ")),e("strong",null,l(n.asignacion?.anioFormacion),1),t[20]||(t[20]=u(" | Docente: ")),e("strong",null,l(n.asignacion?.docente?.nombre),1)])]),_:1})]),_:1}),s(y,{ref:"cardNotas",flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(w,{class:"row items-center"},{default:a(()=>[t[21]||(t[21]=e("div",{class:"text-subtitle1"},"Notas (SER · SABER · HACER · DECIDIR)",-1)),s(T),s(k,{flat:"",dense:"",icon:"refresh",onClick:r.cargarNotas,loading:n.loadingNotas},null,8,["onClick","loading"])]),_:1}),s(V,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:a(()=>[t[23]||(t[23]=e("thead",null,[e("tr",{class:"bg-grey-2"},[e("th",{class:"text-left"},"#"),e("th",{class:"text-left"},"Nombre"),e("th",{class:"text-right"},"SER (10)"),e("th",{class:"text-right"},"SABER (35)"),e("th",{class:"text-right"},"HACER (35)"),e("th",{class:"text-right"},"DECIDIR (10)"),e("th",{class:"text-right"},"TOTAL (90)")])],-1)),e("tbody",null,[r.rowsEstudiantes.length===0?(d(),h("tr",O,[e("td",W,[s(g,{name:"warning",class:"q-mr-sm"}),t[22]||(t[22]=u(" Sin estudiantes "))])])):C("",!0),(d(!0),h(R,null,N(r.rowsEstudiantes,(i,v)=>(d(),h("tr",{key:i.id},[e("td",null,l(v+1),1),e("td",null,l(i.nombre),1),e("td",Z,l(r.nota(i.id,"ser")),1),e("td",J,l(r.nota(i.id,"saber")),1),e("td",K,l(r.nota(i.id,"hacer")),1),e("td",X,l(r.nota(i.id,"decidir")),1),e("td",$,l(r.totalNota(i.id)),1)]))),128))])]),_:1})]),_:1},512),s(y,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(w,{class:"row q-col-gutter-md items-center"},{default:a(()=>[e("div",tt,[s(Q,{modelValue:n.desde,"onUpdate:modelValue":t[7]||(t[7]=i=>n.desde=i),label:"Desde (YYYY-MM-DD)",dense:"",outlined:"",mask:"date"},{prepend:a(()=>[s(g,{name:"event"})]),default:a(()=>[s(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[s(I,{modelValue:n.desde,"onUpdate:modelValue":t[6]||(t[6]=i=>n.desde=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),e("div",et,[s(Q,{modelValue:n.hasta,"onUpdate:modelValue":t[9]||(t[9]=i=>n.hasta=i),label:"Hasta (YYYY-MM-DD)",dense:"",outlined:"",mask:"date"},{prepend:a(()=>[s(g,{name:"event"})]),default:a(()=>[s(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[s(I,{modelValue:n.hasta,"onUpdate:modelValue":t[8]||(t[8]=i=>n.hasta=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),e("div",st,[s(k,{outline:"",color:"primary",label:"Actualizar resumen",onClick:r.cargarResumen,loading:n.loadingResumen},null,8,["onClick","loading"])])]),_:1})]),_:1}),s(V,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:a(()=>[t[25]||(t[25]=e("thead",null,[e("tr",{class:"bg-grey-2"},[e("th",{class:"text-left"},"#"),e("th",{class:"text-left"},"Nombre"),e("th",{class:"text-left"},"CI"),e("th",{class:"text-right"},"Presentes"),e("th",{class:"text-right"},"Tardes"),e("th",{class:"text-right"},"Ausentes"),e("th",{class:"text-right"},"Licencias"),e("th",{class:"text-right"},"Total"),e("th",{class:"text-right"},"% Asistencia")])],-1)),e("tbody",null,[r.rowsEstudiantes.length===0?(d(),h("tr",at,[e("td",ot,[s(g,{name:"warning",class:"q-mr-sm"}),t[24]||(t[24]=u(" Sin datos disponibles "))])])):C("",!0),(d(!0),h(R,null,N(r.rowsEstudiantes,(i,v)=>(d(),h("tr",{key:i.id},[e("td",null,l(v+1),1),e("td",null,l(i.nombre),1),e("td",null,l(i.ci),1),e("td",it,l(n.resumen[i.id]?.presentes??0),1),e("td",nt,l(n.resumen[i.id]?.tardes??0),1),e("td",lt,l(n.resumen[i.id]?.ausentes??0),1),e("td",rt,l(n.resumen[i.id]?.licencias??0),1),e("td",dt,l(n.resumen[i.id]?.total??0),1),e("td",ut,l(n.resumen[i.id]?.porcentaje??0)+"%",1)]))),128))])]),_:1})]))]),_:1})}const Rt=q(Y,[["render",ct]]);export{Rt as default};
