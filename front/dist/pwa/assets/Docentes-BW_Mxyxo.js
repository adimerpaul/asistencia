import{_ as C,c as b,o as m,w as a,a as e,Q as w,e as h,b as r,a7 as d,d as i,W as p,a1 as D,Z as _,f as u,h as Q,t as U,ae as y,a2 as k,af as x}from"./index-D2Z0pOy-.js";import{Q as v,a as c}from"./QItem-BWajZLNV.js";import{Q as P}from"./QList-CJsH7K94.js";import{Q as S,C as f}from"./ClosePopup-BZ6v0ACu.js";import{Q as q,a as E}from"./QTable-B4ZO_KTG.js";import{Q as I}from"./QSpace-hZqprOyc.js";import{Q as N}from"./QSelect-DZr-FKLW.js";import{Q as T}from"./QForm-DRmFngLT.js";import{Q as B}from"./QPage-CB_BnOr-.js";import"./format-BR2WUeZQ.js";import"./selection-CmAng5ju.js";import"./QMarkupTable-DVBySXu3.js";import"./use-fullscreen-DKc0lIYJ.js";import"./QChip-9E6Svwm9.js";import"./QItemLabel-Dde4uuZK.js";const R={name:"DocentesPage",data(){return{docentes:[],docente:{},dialog:!1,loading:!1,filter:"",crearUsuario:!1,usuario:{username:"",email:"",password:"",role:"Docente"},verPass:!1,roles:[{label:"Docente",value:"Docente"},{label:"Administrador",value:"Administrador"}],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",field:"nombre",align:"left"},{name:"ci",label:"CI",field:"ci",align:"left"},{name:"email",label:"Email",field:"email",align:"left"},{name:"telefono",label:"Teléfono",field:"telefono",align:"left"},{name:"usuario",label:"Usuario",field:t=>t.user?.username||"-",align:"left"},{name:"rol",label:"Rol",field:t=>t.user?.role||"-",align:"left"}],_debounceId:null}},mounted(){this.obtenerDocentes()},methods:{debouncedFetch(){clearTimeout(this._debounceId),this._debounceId=setTimeout(()=>this.obtenerDocentes(),350)},obtenerDocentes(){this.loading=!0,this.$axios.get("docentes",{params:{search:this.filter||void 0}}).then(t=>{this.docentes=t.data}).catch(t=>this.$alert.error(t.response?.data?.message||"Error al obtener docentes")).finally(()=>{this.loading=!1})},nuevoDocente(){this.docente={},this.crearUsuario=!1,this.usuario={username:"",email:"",password:"",role:"Docente"},this.dialog=!0},editarDocente(t){this.docente={...t},t.user?(this.crearUsuario=!0,this.usuario={username:t.user.username||"",email:t.user.email||t.email||"",password:"",role:t.user.role||"Docente"}):(this.crearUsuario=!1,this.usuario={username:"",email:this.docente.email||"",password:"",role:"Docente"}),this.dialog=!0},autocompletarUsername(){const t=(this.docente.ci||this.docente.email||this.docente.nombre||"").toString().trim();this.usuario.username=t.replace(/\s+/g,".").replace(/@.*$/,"").toLowerCase()},generarPassword(){const t=Math.random().toString(36).slice(-8);this.usuario.password=`Doc-${t}`},guardarDocente(){this.loading=!0;const t={...this.docente,crear_usuario:this.crearUsuario,usuario:this.crearUsuario?this.usuario:void 0};(this.docente.id?this.$axios.put(`docentes/${this.docente.id}`,t):this.$axios.post("docentes",t)).then(()=>{this.$alert.success("Docente guardado"),this.dialog=!1,this.obtenerDocentes()}).catch(g=>{this.$alert.error(g.response?.data?.message||"Error al guardar")}).finally(()=>{this.loading=!1})},eliminarDocente(t){this.$alert.dialog("¿Desea eliminar este docente?").onOk(()=>{this.loading=!0,this.$axios.delete(`docentes/${t}`).then(()=>{this.$alert.success("Docente eliminado"),this.obtenerDocentes()}).catch(o=>this.$alert.error(o.response?.data?.message||"Error al eliminar")).finally(()=>{this.loading=!1})})},resetPassword(t){this.$alert.dialog("Se generará una nueva contraseña para este usuario. ¿Continuar?").onOk(()=>{this.loading=!0,this.$axios.post(`docentes/${t.id}/reset-password`).then(o=>{const g=o.data?.password;this.$alert.success(`Nueva contraseña: ${g}`)}).catch(o=>this.$alert.error(o.response?.data?.message||"No se pudo resetear la contraseña")).finally(()=>{this.loading=!1})})}}},A={class:"row q-col-gutter-sm"},F={class:"col-12 col-md-3"},O={class:"text-h6"},z={class:"row"},L={class:"col-12 col-md-6"},j={class:"col-12 col-md-3"},G={class:"col-12 col-md-3"},H={class:"col-12 col-md-6"},M={class:"row items-center"},W={class:"col-auto"},Z={key:0,class:"row"},J={class:"col-12 col-md-4"},K={class:"col-12 col-md-4"},X={class:"col-12 col-md-4"},Y={class:"col-12 col-md-4"},$={class:"row justify-end q-gutter-sm q-mt-md"};function ee(t,o,g,oe,l,n){return m(),b(B,{class:"q-pa-md"},{default:a(()=>[e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[r("div",A,[r("div",F,[e(d,{modelValue:l.filter,"onUpdate:modelValue":[o[0]||(o[0]=s=>l.filter=s),n.debouncedFetch],label:"Buscar por nombre/CI/email",dense:"",outlined:"",clearable:""},{append:a(()=>[e(i,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),e(q,{rows:l.docentes,columns:l.columns,flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Docentes",filter:l.filter},{"top-right":a(()=>[e(u,{label:"Nuevo",icon:"add_circle_outline",color:"primary",onClick:n.nuevoDocente,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),"body-cell-actions":a(s=>[e(E,{props:s},{default:a(()=>[e(S,{label:"Acciones",color:"primary",size:"sm","no-caps":""},{default:a(()=>[e(P,null,{default:a(()=>[p((m(),b(v,{clickable:"",onClick:V=>n.editarDocente(s.row)},{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(i,{name:"edit"})]),_:1}),e(c,null,{default:a(()=>o[12]||(o[12]=[_("Editar")])),_:1})]),_:2},1032,["onClick"])),[[f]]),s.row.user?p((m(),b(v,{key:0,clickable:"",onClick:V=>n.resetPassword(s.row)},{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(i,{name:"vpn_key"})]),_:1}),e(c,null,{default:a(()=>o[13]||(o[13]=[_("Resetear contraseña")])),_:1})]),_:2},1032,["onClick"])),[[f]]):D("",!0),p((m(),b(v,{clickable:"",onClick:V=>n.eliminarDocente(s.row.id)},{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(i,{name:"delete"})]),_:1}),e(c,null,{default:a(()=>o[14]||(o[14]=[_("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[f]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),e(Q,{modelValue:l.dialog,"onUpdate:modelValue":o[11]||(o[11]=s=>l.dialog=s),persistent:""},{default:a(()=>[e(w,{style:{width:"700px"}},{default:a(()=>[e(h,{class:"row items-center"},{default:a(()=>[r("div",O,U(l.docente.id?"Editar":"Nuevo")+" Docente",1),e(I),p(e(u,{flat:"",icon:"close"},null,512),[[f]])]),_:1}),e(y),e(h,null,{default:a(()=>[e(T,{onSubmit:n.guardarDocente,class:"q-gutter-md"},{default:a(()=>[o[16]||(o[16]=r("div",{class:"text-subtitle2 text-grey-8"},"Datos del docente",-1)),r("div",z,[r("div",L,[e(d,{modelValue:l.docente.nombre,"onUpdate:modelValue":o[1]||(o[1]=s=>l.docente.nombre=s),label:"Nombre",dense:"",outlined:"",rules:[s=>!!s||"Requerido"]},{prepend:a(()=>[e(i,{name:"person"})]),_:1},8,["modelValue","rules"])]),r("div",j,[e(d,{modelValue:l.docente.ci,"onUpdate:modelValue":o[2]||(o[2]=s=>l.docente.ci=s),label:"CI",dense:"",outlined:"",rules:[s=>!!s||"Requerido"]},{prepend:a(()=>[e(i,{name:"badge"})]),_:1},8,["modelValue","rules"])]),r("div",G,[e(d,{modelValue:l.docente.telefono,"onUpdate:modelValue":o[3]||(o[3]=s=>l.docente.telefono=s),label:"Teléfono",dense:"",outlined:""},{prepend:a(()=>[e(i,{name:"call"})]),_:1},8,["modelValue"])]),r("div",H,[e(d,{modelValue:l.docente.email,"onUpdate:modelValue":o[4]||(o[4]=s=>l.docente.email=s),label:"Email",dense:"",outlined:"",type:"email"},{prepend:a(()=>[e(i,{name:"mail"})]),_:1},8,["modelValue"])])]),e(y,{spaced:""}),r("div",M,[o[15]||(o[15]=r("div",{class:"col"},[r("div",{class:"text-subtitle2 text-grey-8"},"Usuario de acceso"),r("div",{class:"text-caption text-grey-7"}," (Opcional) Crear o actualizar la cuenta de acceso vinculada al docente ")],-1)),r("div",W,[e(x,{modelValue:l.crearUsuario,"onUpdate:modelValue":o[5]||(o[5]=s=>l.crearUsuario=s),color:"primary",label:"Habilitar"},null,8,["modelValue"])])]),l.crearUsuario?(m(),k("div",Z,[r("div",J,[e(d,{modelValue:l.usuario.username,"onUpdate:modelValue":o[6]||(o[6]=s=>l.usuario.username=s),label:"Usuario",dense:"",outlined:"",rules:[s=>!!s||"Requerido"]},{prepend:a(()=>[e(i,{name:"account_circle"})]),append:a(()=>[e(u,{dense:"",flat:"",icon:"auto_fix_high",onClick:n.autocompletarUsername},null,8,["onClick"])]),_:1},8,["modelValue","rules"])]),r("div",K,[e(d,{modelValue:l.usuario.email,"onUpdate:modelValue":o[7]||(o[7]=s=>l.usuario.email=s),label:"Email de acceso",dense:"",outlined:"",type:"email"},{prepend:a(()=>[e(i,{name:"alternate_email"})]),_:1},8,["modelValue"])]),r("div",X,[e(d,{modelValue:l.usuario.password,"onUpdate:modelValue":o[9]||(o[9]=s=>l.usuario.password=s),label:"Contraseña",dense:"",outlined:"",type:l.verPass?"text":"password"},{prepend:a(()=>[e(i,{name:"vpn_key"})]),append:a(()=>[e(u,{dense:"",flat:"",icon:l.verPass?"visibility_off":"visibility",onClick:o[8]||(o[8]=s=>l.verPass=!l.verPass)},null,8,["icon"]),e(u,{dense:"",flat:"",icon:"auto_fix_high",onClick:n.generarPassword},null,8,["onClick"])]),_:1},8,["modelValue","type"])]),r("div",Y,[e(N,{modelValue:l.usuario.role,"onUpdate:modelValue":o[10]||(o[10]=s=>l.usuario.role=s),options:l.roles,label:"Rol",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])])):D("",!0),r("div",$,[p(e(u,{flat:"",label:"Cancelar",color:"negative"},null,512),[[f]]),e(u,{label:"Guardar",type:"submit",color:"primary",loading:l.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const he=C(R,[["render",ee]]);export{he as default};
