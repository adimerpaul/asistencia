import{_ as E,c as g,o as n,w as u,b as s,a2 as m,a as o,f as b,Q as f,e as x,t as r,Z as d,ah as k,a9 as V,a1 as w,d as C,a3 as p,a4 as Q,aa as N}from"./index-DplQUD0A.js";import{Q as y}from"./QSpinnerDots-Bv5nZoMY.js";import{Q as _}from"./QBadge-BwRfbJ4F.js";import{Q as R}from"./QMarkupTable-Db7r1ob3.js";import{Q as D}from"./QInnerLoading-pT5z-x46.js";import{Q as M}from"./QPage-DmXXCfK5.js";const A={name:"DetalleCursoPage",data(){return{asignacion:null,loading:!0,loadingNotas:!1,savingNotas:!1,editNotas:!1,notas:{},edicionNotas:{}}},computed:{rowsEstudiantes(){const a=this.asignacion?.estudiantes;return Array.isArray(a)?a:[]}},async mounted(){await this.obtenerDetalle(),await this.cargarNotas()},methods:{normalizar(a){return!a||typeof a!="object"?{curso:{},docente:{},estudiantes:[]}:{...a,curso:a.curso||{},docente:a.docente||{},estudiantes:Array.isArray(a.estudiantes)?a.estudiantes:[]}},obtenerDetalle(){return this.loading=!0,this.$axios.get(`/asignaciones/${this.$route.params.id}`,{params:{with_estudiantes:!0}}).then(a=>{this.asignacion=this.normalizar(a.data)}).catch(()=>{this.asignacion=this.normalizar(null),this.$alert.error("Error al obtener datos del curso")}).finally(()=>{this.loading=!1})},cargarNotas(){return this.loadingNotas=!0,this.$axios.get("/notas",{params:{asignacion_id:this.$route.params.id}}).then(a=>{this.notas=a.data.items||{},this.edicionNotas={},this.rowsEstudiantes.forEach(e=>{const h=this.notas[e.id]||{ser:0,saber:0,hacer:0,decidir:0};this.edicionNotas[e.id]={ser:h.ser,saber:h.saber,hacer:h.hacer,decidir:h.decidir}})}).catch(()=>this.$alert.error("No se pudieron cargar las notas")).finally(()=>{this.loadingNotas=!1})},clamp(a){const e=this.edicionNotas[a];e&&(e.ser=Math.max(0,Math.min(10,Number(e.ser||0))),e.saber=Math.max(0,Math.min(35,Number(e.saber||0))),e.hacer=Math.max(0,Math.min(35,Number(e.hacer||0))),e.decidir=Math.max(0,Math.min(10,Number(e.decidir||0))))},totalLocal(a){const e=this.editNotas?this.edicionNotas[a]:this.notas[a];return e?Number(e.ser||0)+Number(e.saber||0)+Number(e.hacer||0)+Number(e.decidir||0):0},guardarNotasBatch(){const a=this.rowsEstudiantes.map(e=>({estudiante_id:e.id,ser:this.edicionNotas[e.id]?.ser??0,saber:this.edicionNotas[e.id]?.saber??0,hacer:this.edicionNotas[e.id]?.hacer??0,decidir:this.edicionNotas[e.id]?.decidir??0}));this.savingNotas=!0,this.$axios.post("/notas",{asignacion_id:this.$route.params.id,items:a}).then(()=>(this.$alert.success("Notas guardadas"),this.editNotas=!1,this.cargarNotas())).catch(e=>this.$alert.error(e.response?.data?.message||"Error al guardar notas")).finally(()=>{this.savingNotas=!1})},imprimirRegistro(){const a=this.$route.params.id;window.open(`${this.$axios.defaults.baseURL}/asignaciones/${a}/reporte`,"_blank")}}},B={class:"row items-center q-mb-md"},S={class:"col-auto q-gutter-sm"},U={key:0,class:"flex flex-center"},I={key:1},q={class:"text-h6"},T={class:"text-subtitle2"},z={class:"q-mt-sm"},L={class:"text-caption q-mt-sm"},F={class:"col-auto q-gutter-sm"},P={key:0},H={colspan:"7",class:"text-grey-7"},G={class:"text-right"},j={class:"text-right"},Z={class:"text-right"},J={class:"text-right"},K={class:"text-right"};function O(a,e,h,W,t,c){return n(),g(M,{class:"q-pa-md"},{default:u(()=>[s("div",B,[e[3]||(e[3]=s("div",{class:"col"},[s("div",{class:"text-h5 text-bold text-primary"},"Detalle del Curso")],-1)),s("div",S,[o(b,{flat:"",icon:"arrow_back",label:"Volver","no-caps":"",onClick:e[0]||(e[0]=i=>a.$router.push("/curso/"+a.$route.params.id))}),o(b,{outline:"",color:"primary",icon:"how_to_reg",label:"Tomar asistencia","no-caps":"",onClick:e[1]||(e[1]=i=>a.$router.push(`/curso/${a.$route.params.id}/asistencia`))}),o(b,{color:"primary",icon:"picture_as_pdf",label:"Reporte PDF","no-caps":"",onClick:c.imprimirRegistro,disable:!t.asignacion},null,8,["onClick","disable"])])]),t.loading?(n(),m("div",U,[o(y,{color:"primary",size:"40px"})])):(n(),m("div",I,[o(f,{flat:"",bordered:"",class:"q-mb-md"},{default:u(()=>[o(x,null,{default:u(()=>[s("div",q,r(t.asignacion?.curso?.nombre),1),s("div",T,r(t.asignacion?.curso?.descripcion),1),s("div",z,[o(_,{color:"orange",outline:"",class:"q-mr-sm"},{default:u(()=>[d("Formación: "+r(t.asignacion?.curso?.formacion),1)]),_:1}),o(_,{color:"teal",outline:""},{default:u(()=>[d("Tipo: "+r(t.asignacion?.curso?.tipo),1)]),_:1})]),s("div",L,[e[4]||(e[4]=d(" Unidad Educativa: ")),s("strong",null,r(t.asignacion?.unidadEducativa),1),e[5]||(e[5]=d(" | Gestión: ")),s("strong",null,r(t.asignacion?.gestion),1),e[6]||(e[6]=d(" | Año: ")),s("strong",null,r(t.asignacion?.anioFormacion),1),e[7]||(e[7]=d(" | Docente: ")),s("strong",null,r(t.asignacion?.docente?.nombre),1)])]),_:1})]),_:1}),o(f,{flat:"",bordered:""},{default:u(()=>[o(x,{class:"row items-center"},{default:u(()=>[e[8]||(e[8]=s("div",{class:"col"},[s("div",{class:"text-subtitle1 text-bold"},"Evaluaciones (SER · SABER · HACER · DECIDIR)"),s("div",{class:"text-caption text-grey-7"},"Máximos: SER 10, SABER 35, HACER 35, DECIDIR 10 — Total 90")],-1)),s("div",F,[o(k,{modelValue:t.editNotas,"onUpdate:modelValue":e[2]||(e[2]=i=>t.editNotas=i),color:"primary",label:"Editar"},null,8,["modelValue"]),o(b,{disable:!t.editNotas||t.savingNotas,color:"primary",icon:"save",label:"Guardar","no-caps":"",onClick:c.guardarNotasBatch,loading:t.savingNotas},null,8,["disable","onClick","loading"])])]),_:1}),o(V),o(R,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:u(()=>[e[10]||(e[10]=s("thead",null,[s("tr",{class:"bg-grey-2"},[s("th",{class:"text-left"},"#"),s("th",{class:"text-left"},"Nombre"),s("th",{class:"text-right"},"SER (10)"),s("th",{class:"text-right"},"SABER (35)"),s("th",{class:"text-right"},"HACER (35)"),s("th",{class:"text-right"},"DECIDIR (10)"),s("th",{class:"text-right"},"Total (90)")])],-1)),s("tbody",null,[c.rowsEstudiantes.length===0?(n(),m("tr",P,[s("td",H,[o(C,{name:"warning",class:"q-mr-sm"}),e[9]||(e[9]=d(" Sin estudiantes "))])])):w("",!0),(n(!0),m(p,null,Q(c.rowsEstudiantes,(i,v)=>(n(),m("tr",{key:i.id},[s("td",null,r(v+1),1),s("td",null,r(i.nombre),1),s("td",G,[t.editNotas?(n(),g(N,{key:0,modelValue:t.edicionNotas[i.id].ser,"onUpdate:modelValue":[l=>t.edicionNotas[i.id].ser=l,l=>c.clamp(i.id)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"w-90",min:0,max:10},null,8,["modelValue","onUpdate:modelValue"])):(n(),m(p,{key:1},[d(r(t.notas[i.id]?.ser??0),1)],64))]),s("td",j,[t.editNotas?(n(),g(N,{key:0,modelValue:t.edicionNotas[i.id].saber,"onUpdate:modelValue":[l=>t.edicionNotas[i.id].saber=l,l=>c.clamp(i.id)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"w-90",min:0,max:35},null,8,["modelValue","onUpdate:modelValue"])):(n(),m(p,{key:1},[d(r(t.notas[i.id]?.saber??0),1)],64))]),s("td",Z,[t.editNotas?(n(),g(N,{key:0,modelValue:t.edicionNotas[i.id].hacer,"onUpdate:modelValue":[l=>t.edicionNotas[i.id].hacer=l,l=>c.clamp(i.id)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"w-90",min:0,max:35},null,8,["modelValue","onUpdate:modelValue"])):(n(),m(p,{key:1},[d(r(t.notas[i.id]?.hacer??0),1)],64))]),s("td",J,[t.editNotas?(n(),g(N,{key:0,modelValue:t.edicionNotas[i.id].decidir,"onUpdate:modelValue":[l=>t.edicionNotas[i.id].decidir=l,l=>c.clamp(i.id)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"w-90",min:0,max:10},null,8,["modelValue","onUpdate:modelValue"])):(n(),m(p,{key:1},[d(r(t.notas[i.id]?.decidir??0),1)],64))]),s("td",K,r(c.totalLocal(i.id)),1)]))),128))])]),_:1}),o(D,{showing:t.loadingNotas},{default:u(()=>[o(y,{size:"32px"})]),_:1},8,["showing"])]),_:1})]))]),_:1})}const ae=E(A,[["render",O],["__scopeId","data-v-d32d9685"]]);export{ae as default};
