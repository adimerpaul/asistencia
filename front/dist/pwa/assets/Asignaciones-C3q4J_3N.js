import{Q as v}from"./QSelect-DZr-FKLW.js";import{_ as I,c as b,o as r,w as n,a as t,Q as A,e as E,b as i,a7 as V,W as m,d as f,Z as C,f as c,h as U,t as h,a2 as _,a3 as w,a4 as k,ag as D}from"./index-D2Z0pOy-.js";import{Q,a as g}from"./QItem-BWajZLNV.js";import{Q as F}from"./QList-CJsH7K94.js";import{Q as S,C as p}from"./ClosePopup-BZ6v0ACu.js";import{Q as q,a as B}from"./QTable-B4ZO_KTG.js";import{Q as P}from"./QSpace-hZqprOyc.js";import{Q as x}from"./QMarkupTable-DVBySXu3.js";import{Q as N}from"./QPage-CB_BnOr-.js";import"./QChip-9E6Svwm9.js";import"./QItemLabel-Dde4uuZK.js";import"./format-BR2WUeZQ.js";import"./selection-CmAng5ju.js";import"./use-fullscreen-DKc0lIYJ.js";const T={name:"AsignacionesPage",data(){return{asignaciones:[],asignacion:{},loading:!1,dialogEstudiantes:!1,filter:"",filterGestion:null,filterDocenteId:null,filterCursoId:null,filterParalelo:"",gestiones:[],docentes:[],cursos:[],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"docente_id",label:"Docente",field:a=>a.docente?.nombre,align:"left"},{name:"curso_id",label:"Curso",field:a=>a.curso?.nombre,align:"left"},{name:"unidadEducativa",label:"Unidad Educativa",field:"unidadEducativa",align:"left"},{name:"taller",label:"Taller",field:"taller",align:"left"},{name:"fases",label:"Fases",field:"fases",align:"left"},{name:"docentesEncargados",label:"Docentes Encargados",field:"docentesEncargados",align:"left"},{name:"anioFormacion",label:"Año de Formación",field:"anioFormacion",align:"left"},{name:"gestion",label:"Gestión",field:"gestion",align:"left"},{name:"user_id",label:"Usuario",field:a=>a.user?.name,align:"left"}],estudiantes:[],estudiantesAll:[],estudianteFilter:"",estudiantesSeleccionados:[],_debounceId:null}},async mounted(){this.obtenerAsignaciones(),this.$axios.get("cursos").then(e=>{this.cursos=e.data}),this.$axios.get("docentes").then(e=>{this.docentes=e.data}),await this.$axios.get("estudiantes").then(e=>{this.estudiantes=e.data}),this.estudiantesAll=[...this.estudiantes];const a=new Date().getFullYear();for(let e=a-3;e<=a+3;e++)this.gestiones.push(String(e))},methods:{debouncedFetch(){clearTimeout(this._debounceId),this._debounceId=setTimeout(()=>this.obtenerAsignaciones(),350)},obtenerAsignaciones(){this.loading=!0,this.$axios.get("asignaciones",{params:{gestion:this.filterGestion||void 0,docente_id:this.filterDocenteId||void 0,curso_id:this.filterCursoId||void 0,paralelo:this.filterParalelo||void 0,search:this.filter||void 0,with_estudiantes:!1}}).then(a=>{this.asignaciones=a.data}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al obtener asignaciones")}).finally(()=>{this.loading=!1})},abrirAsignacionEstudiantes(a){this.asignacion=a,this.loading=!0,this.$axios.get(`asignaciones/${a.id}`,{params:{with_estudiantes:!0}}).then(e=>{this.asignacion=e.data,this.estudiantesSeleccionados=[...e.data.estudiantes],this.dialogEstudiantes=!0}).catch(e=>{this.$alert.error(e.response?.data?.message||"Error al cargar estudiantes")}).finally(()=>{this.loading=!1})},filtrarEstudiantes(){const a=(this.estudianteFilter||"").toLowerCase();this.estudiantes=a?this.estudiantesAll.filter(e=>(e.nombre||"").toLowerCase().includes(a)):[...this.estudiantesAll]},agregarEstudiante(a){this.loading=!0,this.$axios.post("asignacion-estudiantes",{estudiante_id:a.id,asignacion_id:this.asignacion.id}).then(()=>(this.$alert.success("Estudiante agregado"),this.$axios.get(`asignaciones/${this.asignacion.id}`,{params:{with_estudiantes:!0}}))).then(e=>{this.asignacion=e.data,this.estudiantesSeleccionados=[...e.data.estudiantes]}).catch(e=>this.$alert.error(e.response?.data?.message||"Error al agregar")).finally(()=>{this.loading=!1})},quitarEstudiante(a){this.loading=!0;const e=this.asignacion.estudiantes.find(d=>d.id===a);if(!e){this.$alert.error("No se encontró la relación"),this.loading=!1;return}this.$axios.delete(`asignacion-estudiantes-by-id/${e.pivot.id}`).then(()=>(this.$alert.success("Estudiante quitado"),this.$axios.get(`asignaciones/${this.asignacion.id}`,{params:{with_estudiantes:!0}}))).then(d=>{this.asignacion=d.data,this.estudiantesSeleccionados=[...d.data.estudiantes]}).catch(d=>this.$alert.error(d.response?.data?.message||"Error al quitar")).finally(()=>{this.loading=!1})},eliminarAsignacion(a){this.$alert.dialog("¿Desea eliminar esta asignación?").onOk(()=>{this.loading=!0,this.$axios.delete(`asignaciones/${a}`).then(()=>{this.$alert.success("Asignación eliminada"),this.obtenerAsignaciones()}).catch(e=>this.$alert.error(e.response?.data?.message||"Error al eliminar")).finally(()=>{this.loading=!1})})}}},G={class:"row items-center q-col-gutter-sm"},L={class:"col-12 col-md-2"},z={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},O={class:"col-12 col-md-2"},W={class:"text-bold"},Y={class:"row"},Z={class:"col-12 col-md-6"},j={class:"col-12 col-md-6"};function H(a,e,d,J,l,o){return r(),b(N,{class:"q-pa-md"},{default:n(()=>[t(A,null,{default:n(()=>[t(E,null,{default:n(()=>[i("div",G,[i("div",L,[t(v,{modelValue:l.filterGestion,"onUpdate:modelValue":[e[0]||(e[0]=s=>l.filterGestion=s),o.obtenerAsignaciones],options:l.gestiones,label:"Gestión",outlined:"",dense:"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),i("div",z,[t(v,{modelValue:l.filterDocenteId,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.filterDocenteId=s),o.obtenerAsignaciones],options:l.docentes,"option-label":"nombre","option-value":"id",label:"Docente",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),i("div",M,[t(v,{modelValue:l.filterCursoId,"onUpdate:modelValue":[e[2]||(e[2]=s=>l.filterCursoId=s),o.obtenerAsignaciones],options:l.cursos,"option-label":"nombre","option-value":"id",label:"Curso",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),i("div",O,[t(V,{modelValue:l.filterParalelo,"onUpdate:modelValue":[e[3]||(e[3]=s=>l.filterParalelo=s),o.debouncedFetch],label:"Paralelo",outlined:"",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),t(q,{rows:l.asignaciones,columns:l.columns,flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Asignaciones",filter:l.filter},{"top-right":n(()=>[t(c,{label:"Nueva",icon:"add_circle_outline",color:"primary",loading:l.loading,"no-caps":"",class:"q-mr-md",onClick:e[4]||(e[4]=s=>a.$router.push("/asignaciones/crear"))},null,8,["loading"]),t(c,{icon:"refresh",color:"secondary",loading:l.loading,"no-caps":"",onClick:o.obtenerAsignaciones},null,8,["loading","onClick"]),t(V,{modelValue:l.filter,"onUpdate:modelValue":[e[5]||(e[5]=s=>l.filter=s),o.debouncedFetch],label:"Buscar",dense:"",outlined:"",class:"q-ml-sm",clearable:""},{append:n(()=>[t(f,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),"body-cell-actions":n(s=>[t(B,{props:s},{default:n(()=>[t(S,{label:"Acciones",color:"primary",size:"sm","no-caps":""},{default:n(()=>[t(F,null,{default:n(()=>[m((r(),b(Q,{clickable:"",onClick:u=>a.$router.push(`/asignaciones/${s.row.id}/editar`)},{default:n(()=>[t(g,{avatar:""},{default:n(()=>[t(f,{name:"edit"})]),_:1}),t(g,null,{default:n(()=>e[8]||(e[8]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[p]]),m((r(),b(Q,{clickable:"",onClick:u=>o.abrirAsignacionEstudiantes(s.row)},{default:n(()=>[t(g,{avatar:""},{default:n(()=>[t(f,{name:"group_add"})]),_:1}),t(g,null,{default:n(()=>e[9]||(e[9]=[C("Agregar Estudiantes")])),_:1})]),_:2},1032,["onClick"])),[[p]]),m((r(),b(Q,{clickable:"",onClick:u=>o.eliminarAsignacion(s.row.id)},{default:n(()=>[t(g,{avatar:""},{default:n(()=>[t(f,{name:"delete"})]),_:1}),t(g,null,{default:n(()=>e[10]||(e[10]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[p]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),t(U,{modelValue:l.dialogEstudiantes,"onUpdate:modelValue":e[7]||(e[7]=s=>l.dialogEstudiantes=s),persistent:"","full-width":"","full-height":""},{default:n(()=>[t(A,null,{default:n(()=>[t(E,{class:"row items-center"},{default:n(()=>[i("div",W,"Estudiantes de "+h(l.asignacion.curso?.nombre),1),t(P),m(t(c,{icon:"close",flat:""},null,512),[[p]])]),_:1}),t(E,null,{default:n(()=>[i("div",Y,[i("div",Z,[t(V,{modelValue:l.estudianteFilter,"onUpdate:modelValue":[e[6]||(e[6]=s=>l.estudianteFilter=s),o.filtrarEstudiantes],label:"Buscar Estudiante",dense:"",outlined:"",class:"q-mb-sm"},{append:n(()=>[t(f,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(x,{bordered:"",flat:"",dense:"","wrap-cells":""},{default:n(()=>[e[11]||(e[11]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{class:"text-left"},"#"),i("th",{class:"text-left"},"Nombre"),i("th",{class:"text-left"},"Agregar")])],-1)),i("tbody",null,[(r(!0),_(w,null,k(l.estudiantes,(s,u)=>(r(),_("tr",{key:s.id},[i("td",null,h(u+1),1),i("td",null,h(s.nombre),1),i("td",null,[t(c,{icon:"add_circle_outline",color:"primary",size:"xs",dense:"","no-caps":"",loading:l.loading,label:"Agregar",onClick:y=>o.agregarEstudiante(s)},null,8,["loading","onClick"])])]))),128))])]),_:1})]),i("div",j,[t(x,{bordered:"",flat:"",dense:"","wrap-cells":""},{default:n(()=>[e[12]||(e[12]=i("thead",null,[i("tr",{class:"bg-grey-3"},[i("th",{class:"text-left"},"#"),i("th",{class:"text-left"},"Nombre"),i("th",{class:"text-left"},"Quitar")])],-1)),i("tbody",null,[(r(!0),_(w,null,k(l.estudiantesSeleccionados,(s,u)=>(r(),_("tr",{key:s.id},[i("td",null,h(u+1),1),i("td",null,h(s.nombre),1),i("td",null,[t(c,{icon:"remove_circle_outline",color:"negative",size:"xs",dense:"","no-caps":"",loading:l.loading,label:"Quitar",onClick:y=>o.quitarEstudiante(s.id)},null,8,["loading","onClick"])])]))),128))])]),_:1})])])]),_:1}),t(D,{align:"right"},{default:n(()=>[m(t(c,{flat:"",label:"Cerrar",color:"negative"},null,512),[[p]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ue=I(T,[["render",H]]);export{ue as default};
