import{_ as F,c as E,o as d,w as n,a,W as m,d as b,Z as A,f as r,a7 as c,h as Q,Q as C,e as V,b as t,t as f,a2 as v,a3 as k,a4 as w,ae as U}from"./index-f0j5J7J4.js";import{Q as _,a as p}from"./QItem-Bx6qN7fO.js";import{a as S}from"./format-dH-XREpz.js";import{Q as D,C as h}from"./ClosePopup-BKbzAN2V.js";import{Q as B}from"./QTd-EWrBRMI4.js";import{Q as N,a as x,b as y}from"./QTable-CE0s5Pio.js";import{Q as T}from"./QForm-D9EVjkHu.js";import{Q as I}from"./QSpace-DrtNk_fG.js";import{Q as L}from"./QPage-uAwsrSle.js";import"./selection-BqZwZZ_Q.js";import"./use-fullscreen-MtywWtdr.js";const z={name:"AsignacionesPage",data(){return{asignaciones:[],asignacion:{},dialog:!1,loading:!1,filter:"",docentes:[],cursos:[],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"docente_id",label:"Docente",field:s=>s.docente?.nombre,align:"left"},{name:"curso_id",label:"Curso",field:s=>s.curso?.nombre,align:"left"},{name:"unidadEducativa",label:"Unidad Educativa",field:"unidadEducativa",align:"left"},{name:"taller",label:"Taller",field:"taller",align:"left"},{name:"fases",label:"Fases",field:"fases",align:"left"},{name:"docentesEncargados",label:"Docentes Encargados",field:"docentesEncargados",align:"left"},{name:"anioFormacion",label:"Año de Formación",field:"anioFormacion",align:"left"},{name:"gestion",label:"Gestión",field:"gestion",align:"left"},{name:"user_id",label:"Usuario",field:s=>s.user?.name,align:"left"}],gestiones:[],estudiantes:[],estudiantesAll:[],estudianteFilter:"",estudiantesSeleccionados:[],dialogEstudiantes:!1}},async mounted(){this.obtenerAsignaciones(),this.$axios.get("cursos").then(e=>this.cursos=e.data),this.$axios.get("docentes").then(e=>this.docentes=e.data),await this.$axios.get("estudiantes").then(e=>this.estudiantes=e.data),this.estudiantesAll=[...this.estudiantes];const s=new Date().getFullYear();for(let e=s-3;e<=s+3;e++)this.gestiones.push({label:e.toString(),value:e})},methods:{agregarEstudiante(s){this.loading=!0,this.$axios.post("asignacion-estudiantes",{estudiante_id:s.id,asignacion_id:this.asignacion.id}).then(()=>{this.$alert.success("Estudiante agregado a la asignación"),this.estudiantesSeleccionados.push(s),this.filtrarEstudiantes()}).catch(e=>{this.$alert.error(e.response?.data?.message||"Error al agregar estudiante")}).finally(()=>{this.loading=!1})},filtrarEstudiantes(){this.estudianteFilter===""?this.estudiantes=[...this.estudiantesAll]:this.estudiantes=this.estudiantesAll.filter(s=>s.nombre.toLowerCase().includes(this.estudianteFilter.toLowerCase()))},quitarEstudiante(s){this.loading=!0;const e=this.asignacion.estudiantes?.find(u=>u.id===s||u.estudiante_id===s);if(!e){this.$alert.error("No se encontró el ID de la relación para eliminar"),this.loading=!1;return}this.$axios.delete(`asignacion-estudiantes-by-id/${e.pivot?.id||e.id}`).then(()=>{this.$alert.success("Estudiante eliminado"),this.estudiantesSeleccionados=this.estudiantesSeleccionados.filter(u=>u.id!==s),this.filtrarEstudiantes()}).catch(u=>{this.$alert.error(u.response?.data?.message||"Error al quitar estudiante")}).finally(()=>{this.loading=!1})},abrirAsignacionEstudiantes(s){this.estudiantesSeleccionados=s.estudiantes||[],this.dialogEstudiantes=!0,this.asignacion=s},obtenerAsignaciones(){this.loading=!0,this.$axios.get("asignaciones").then(s=>{this.asignaciones=s.data}).catch(s=>{this.$alert.error(s.response?.data?.message||"Error al obtener asignaciones")}).finally(()=>{this.loading=!1})},nuevaAsignacion(){this.asignacion={},this.dialog=!0},editarAsignacion(s){this.asignacion={...s},this.dialog=!0},guardarAsignacion(){this.loading=!0,(this.asignacion.id?this.$axios.put(`asignaciones/${this.asignacion.id}`,this.asignacion):this.$axios.post("asignaciones",this.asignacion)).then(()=>{this.$alert.success("Asignación guardada"),this.dialog=!1,this.obtenerAsignaciones()}).catch(e=>{this.$alert.error(e.response?.data?.message||"Error al guardar")}).finally(()=>{this.loading=!1})},eliminarAsignacion(s){this.$alert.dialog("¿Desea eliminar esta asignación?").onOk(()=>{this.loading=!0,this.$axios.delete(`asignaciones/${s}`).then(()=>{this.$alert.success("Asignación eliminada"),this.obtenerAsignaciones()}).catch(e=>{this.$alert.error(e.response?.data?.message||"Error al eliminar")}).finally(()=>{this.loading=!1})})}}},G={class:"text-h6"},P={class:"text-right"},Y={class:"text-bold"},M={class:"row"},O={class:"col-12 col-md-6"},W={class:"col-12 col-md-6"};function Z(s,e,u,j,i,o){return d(),E(L,{class:"q-pa-md"},{default:n(()=>[a(N,{rows:i.asignaciones,columns:i.columns,flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Asignaciones",filter:i.filter},{"top-right":n(()=>[a(r,{label:"Nueva",icon:"add_circle_outline",color:"primary",onClick:o.nuevaAsignacion,loading:i.loading,"no-caps":"",class:"q-mr-md"},null,8,["onClick","loading"]),a(r,{icon:"refresh",color:"secondary",onClick:o.obtenerAsignaciones,loading:i.loading,"no-caps":""},null,8,["onClick","loading"]),a(c,{modelValue:i.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>i.filter=l),label:"Buscar",dense:"",outlined:"",class:"q-ml-sm"},{append:n(()=>[a(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":n(l=>[a(B,{props:l},{default:n(()=>[a(D,{label:"Acciones",color:"primary",size:"sm","no-caps":""},{default:n(()=>[a(S,null,{default:n(()=>[m((d(),E(_,{clickable:"",onClick:g=>o.editarAsignacion(l.row)},{default:n(()=>[a(p,{avatar:""},{default:n(()=>[a(b,{name:"edit"})]),_:1}),a(p,null,{default:n(()=>e[12]||(e[12]=[A("Editar")])),_:1})]),_:2},1032,["onClick"])),[[h]]),m((d(),E(_,{clickable:"",onClick:g=>o.abrirAsignacionEstudiantes(l.row)},{default:n(()=>[a(p,{avatar:""},{default:n(()=>[a(b,{name:"group_add"})]),_:1}),a(p,null,{default:n(()=>e[13]||(e[13]=[A("Agregar Estudiantes")])),_:1})]),_:2},1032,["onClick"])),[[h]]),m((d(),E(_,{clickable:"",onClick:g=>o.eliminarAsignacion(l.row.id)},{default:n(()=>[a(p,{avatar:""},{default:n(()=>[a(b,{name:"delete"})]),_:1}),a(p,null,{default:n(()=>e[14]||(e[14]=[A("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[h]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),a(Q,{modelValue:i.dialog,"onUpdate:modelValue":e[9]||(e[9]=l=>i.dialog=l),persistent:""},{default:n(()=>[a(C,{style:{width:"500px"}},{default:n(()=>[a(V,null,{default:n(()=>[t("div",G,f(i.asignacion.id?"Editar":"Nueva")+" Asignación",1)]),_:1}),a(V,null,{default:n(()=>[a(T,{onSubmit:o.guardarAsignacion},{default:n(()=>[a(x,{modelValue:i.asignacion.curso_id,"onUpdate:modelValue":e[1]||(e[1]=l=>i.asignacion.curso_id=l),options:i.cursos,label:"Curso","option-label":"nombre","option-value":"id",outlined:"",dense:"",hint:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),a(x,{modelValue:i.asignacion.docente_id,"onUpdate:modelValue":e[2]||(e[2]=l=>i.asignacion.docente_id=l),options:i.docentes,label:"Docente","option-label":"nombre","option-value":"id",outlined:"",dense:"",hint:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),a(c,{modelValue:i.asignacion.unidadEducativa,"onUpdate:modelValue":e[3]||(e[3]=l=>i.asignacion.unidadEducativa=l),label:"Unidad Educativa",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),a(c,{modelValue:i.asignacion.taller,"onUpdate:modelValue":e[4]||(e[4]=l=>i.asignacion.taller=l),label:"Taller",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),a(c,{modelValue:i.asignacion.fases,"onUpdate:modelValue":e[5]||(e[5]=l=>i.asignacion.fases=l),label:"Fases",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),a(c,{modelValue:i.asignacion.docentesEncargados,"onUpdate:modelValue":e[6]||(e[6]=l=>i.asignacion.docentesEncargados=l),label:"Docentes Encargados",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),a(c,{modelValue:i.asignacion.anioFormacion,"onUpdate:modelValue":e[7]||(e[7]=l=>i.asignacion.anioFormacion=l),label:"Año de Formación",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),a(x,{modelValue:i.asignacion.gestion,"onUpdate:modelValue":e[8]||(e[8]=l=>i.asignacion.gestion=l),options:i.gestiones,label:"Gestión","option-label":"label","option-value":"label",outlined:"",dense:"",class:"q-mb-sm","emit-value":"","map-options":""},null,8,["modelValue","options"]),t("div",P,[m(a(r,{flat:"",label:"Cancelar",color:"negative"},null,512),[[h]]),a(r,{label:"Guardar",type:"submit",color:"primary",class:"q-ml-sm",loading:i.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Q,{modelValue:i.dialogEstudiantes,"onUpdate:modelValue":e[11]||(e[11]=l=>i.dialogEstudiantes=l),persistent:"","full-width":"","full-height":""},{default:n(()=>[a(C,{style:{width:"500px"}},{default:n(()=>[a(V,{class:"row items-center"},{default:n(()=>[t("div",Y,"Estudiantes de "+f(i.asignacion.curso?.nombre),1),a(I),m(a(r,{icon:"close",flat:"",class:"q-ml-auto"},null,512),[[h]])]),_:1}),a(V,null,{default:n(()=>[t("div",M,[t("div",O,[a(c,{modelValue:i.estudianteFilter,"onUpdate:modelValue":[e[10]||(e[10]=l=>i.estudianteFilter=l),o.filtrarEstudiantes],label:"Buscar Estudiante",dense:"",outlined:"",class:"q-mb-sm"},{append:n(()=>[a(b,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),a(y,{bordered:"",flat:"",dense:"","wrap-cells":""},{default:n(()=>[e[15]||(e[15]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",{class:"text-left"},"#"),t("th",{class:"text-left"},"Nombre"),t("th",{class:"text-left"},"Agregar")])],-1)),t("tbody",null,[(d(!0),v(k,null,w(i.estudiantes,(l,g)=>(d(),v("tr",{key:l.id},[t("td",null,f(g+1),1),t("td",null,f(l.nombre),1),t("td",null,[a(r,{icon:"add_circle_outline",onClick:q=>o.agregarEstudiante(l),loading:i.loading,color:"primary",size:"xs",dense:"",label:"Agregar","no-caps":""},null,8,["onClick","loading"])])]))),128))])]),_:1})]),t("div",W,[a(y,{bordered:"",flat:"",dense:"","wrap-cells":""},{default:n(()=>[e[16]||(e[16]=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"#"),t("th",{class:"text-left"},"Nombre"),t("th",{class:"text-left"},"Quitar")])],-1)),t("tbody",null,[(d(!0),v(k,null,w(i.estudiantesSeleccionados,(l,g)=>(d(),v("tr",{key:l.id},[t("td",null,f(g+1),1),t("td",null,f(l.nombre),1),t("td",null,[a(r,{icon:"remove_circle_outline",color:"negative",size:"xs",dense:"",onClick:q=>o.quitarEstudiante(l.id),label:"Quitar","no-caps":"",loading:i.loading},null,8,["onClick","loading"])])]))),128))])]),_:1})])])]),_:1}),a(U,{align:"right"},{default:n(()=>[m(a(r,{flat:"",label:"Cerrar",color:"negative"},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ne=F(z,[["render",Z]]);export{ne as default};
