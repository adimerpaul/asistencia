import{_ as q,c as p,o as d,w as a,b as s,a2 as f,a as e,f as k,W as _,d as h,Z as c,Q as y,e as w,t as l,a1 as C,a3 as R,a4 as N,a7 as Q}from"./index-D2Z0pOy-.js";import{Q as b,a as m}from"./QItem-BWajZLNV.js";import{Q as E}from"./QList-CJsH7K94.js";import{Q as D,C as x}from"./ClosePopup-BZ6v0ACu.js";import{Q as B}from"./QSpinnerDots-z6ZZazoq.js";import{Q as A}from"./QBadge-DeeV9kLt.js";import{Q as T}from"./QSpace-hZqprOyc.js";import{Q as V}from"./QMarkupTable-DVBySXu3.js";import{Q as S,a as I}from"./QPopupProxy-B8lqnEor.js";import{Q as P}from"./QPage-CB_BnOr-.js";import"./format-BR2WUeZQ.js";import"./selection-CmAng5ju.js";import"./use-render-cache-DLxPkVnQ.js";const Y={name:"DetalleCursoPage",data(){return{asignacion:null,loading:!0,loadingNotas:!1,notas:{},loadingResumen:!1,resumen:{},desde:null,hasta:null}},computed:{rowsEstudiantes(){const o=this.asignacion?.estudiantes;return Array.isArray(o)?o:[]}},async mounted(){await this.obtenerDetalle(),await Promise.all([this.cargarNotas(),this.cargarResumen()])},methods:{scrollToNotas(){const o=this.$refs.cardNotas?.$el||this.$refs.cardNotas;o&&o.scrollIntoView&&o.scrollIntoView({behavior:"smooth",block:"start"})},openReporte(o){const t=this.$route.params.id,u=this.$axios.defaults.baseURL;if(o==="registro"&&window.open(`${u}/asignaciones/${t}/reporte-evaluaciones`,"_blank"),o==="notas"&&window.open(`${u}/asignaciones/${t}/reporte-notas`,"_blank"),o==="asistencia"){const g=new URLSearchParams;this.desde&&g.append("desde",this.desde),this.hasta&&g.append("hasta",this.hasta);const n=g.toString()?`?${g.toString()}`:"";window.open(`${u}/asignaciones/${t}/reporte-asistencia${n}`,"_blank")}},normalizar(o){return!o||typeof o!="object"?{curso:{},docente:{},estudiantes:[]}:{...o,curso:o.curso||{},docente:o.docente||{},estudiantes:Array.isArray(o.estudiantes)?o.estudiantes:[]}},obtenerDetalle(){return this.loading=!0,this.$axios.get(`/asignaciones/${this.$route.params.id}`,{params:{with_estudiantes:!0}}).then(o=>{this.asignacion=this.normalizar(o.data)}).catch(()=>{this.asignacion=this.normalizar(null),this.$alert.error("Error al obtener datos del curso")}).finally(()=>{this.loading=!1})},async cargarNotas(){this.loadingNotas=!0;try{const{data:o}=await this.$axios.get("/notas",{params:{asignacion_id:this.$route.params.id}}),t=o?.items??o??[];if(Array.isArray(t)){const u={};t.forEach(g=>{g?.estudiante_id&&(u[g.estudiante_id]=g)}),this.notas=u}else this.notas=t||{}}catch{this.$alert.error("No se pudieron cargar las notas")}finally{this.loadingNotas=!1}},nota(o,t){const u=this.notas[o]||{};return Number.isFinite(+u[t])?+u[t]:0},totalNota(o){const t=this.notas[o]||{},u=+(t.ser||0)+ +(t.saber||0)+ +(t.hacer||0)+ +(t.decidir||0);return Number.isFinite(u)?u:0},cargarResumen(){if(this.$route.params.id)return this.loadingResumen=!0,this.$axios.get("/asistencias/resumen",{params:{asignacion_id:this.$route.params.id,desde:this.desde||void 0,hasta:this.hasta||void 0}}).then(o=>{this.resumen=o.data.items||{}}).catch(()=>{this.$alert.error("No se pudo cargar el resumen de asistencia")}).finally(()=>{this.loadingResumen=!1})}}},U={class:"row items-center q-mb-md"},L={class:"col-auto q-gutter-sm"},z={key:0,class:"flex flex-center"},F={key:1},M={class:"text-h6"},H={class:"text-subtitle2"},j={class:"q-mt-sm"},G={class:"text-caption q-mt-sm"},O={key:0},W={colspan:"7",class:"text-grey-7"},Z={class:"text-right"},J={class:"text-right"},K={class:"text-right"},X={class:"text-right"},$={class:"text-right text-weight-medium"},tt={class:"col-12 col-md-3"},st={class:"col-12 col-md-3"},et={class:"col-12 col-md-3"},at={key:0},ot={colspan:"9",class:"text-grey-7"},it={class:"text-right"},nt={class:"text-right"},lt={class:"text-right"},rt={class:"text-right"},dt={class:"text-right"},ut={class:"text-right"};function ct(o,t,u,g,n,r){return d(),p(P,{class:"q-pa-md"},{default:a(()=>[s("div",U,[t[14]||(t[14]=s("div",{class:"col"},[s("div",{class:"text-h5 text-bold text-primary"},"Detalle del Curso")],-1)),s("div",L,[e(k,{flat:"",icon:"arrow_back",label:"Volver","no-caps":"",onClick:t[0]||(t[0]=i=>o.$router.back())}),e(D,{color:"primary",outline:"",icon:"manage_accounts",label:"Acciones","no-caps":""},{default:a(()=>[e(E,null,{default:a(()=>[_((d(),p(b,{clickable:"",onClick:t[1]||(t[1]=i=>o.$router.push(`/curso/${o.$route.params.id}/asistencia`))},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(h,{name:"how_to_reg"})]),_:1}),e(m,null,{default:a(()=>t[9]||(t[9]=[c("Tomar asistencia")])),_:1})]),_:1})),[[x]]),_((d(),p(b,{clickable:"",onClick:r.scrollToNotas},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(h,{name:"grading"})]),_:1}),e(m,null,{default:a(()=>t[10]||(t[10]=[c("Ir a notas")])),_:1})]),_:1},8,["onClick"])),[[x]])]),_:1})]),_:1}),e(D,{color:"primary",icon:"picture_as_pdf",label:"Reportes","no-caps":"",disable:!n.asignacion},{default:a(()=>[e(E,null,{default:a(()=>[_((d(),p(b,{clickable:"",onClick:t[2]||(t[2]=i=>r.openReporte("registro"))},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(h,{name:"table_chart"})]),_:1}),e(m,null,{default:a(()=>t[11]||(t[11]=[c("Registro (E1..E12)")])),_:1})]),_:1})),[[x]]),_((d(),p(b,{clickable:"",onClick:t[3]||(t[3]=i=>r.openReporte("notas"))},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(h,{name:"grading"})]),_:1}),e(m,null,{default:a(()=>t[12]||(t[12]=[c("Notas (SER/SABER/HACER/DECIDIR)")])),_:1})]),_:1})),[[x]]),_((d(),p(b,{clickable:"",onClick:t[4]||(t[4]=i=>r.openReporte("asistencia"))},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(h,{name:"event_available"})]),_:1}),e(m,null,{default:a(()=>t[13]||(t[13]=[c("Asistencia")])),_:1})]),_:1})),[[x]])]),_:1})]),_:1},8,["disable"])])]),n.loading?(d(),f("div",z,[e(B,{color:"primary",size:"40px"})])):(d(),f("div",F,[e(y,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(w,null,{default:a(()=>[s("div",M,l(n.asignacion?.curso?.nombre),1),s("div",H,l(n.asignacion?.curso?.descripcion),1),s("div",j,[e(A,{color:"orange",outline:"",class:"q-mr-sm"},{default:a(()=>[c("Formación: "+l(n.asignacion?.curso?.formacion),1)]),_:1}),e(A,{color:"teal",outline:""},{default:a(()=>[c("Tipo: "+l(n.asignacion?.curso?.tipo),1)]),_:1})]),s("div",G,[t[15]||(t[15]=c(" Unidad Educativa: ")),s("strong",null,l(n.asignacion?.unidadEducativa),1),t[16]||(t[16]=c(" | Gestión: ")),s("strong",null,l(n.asignacion?.gestion),1),t[17]||(t[17]=c(" | Año: ")),s("strong",null,l(n.asignacion?.anioFormacion),1),t[18]||(t[18]=c(" | Docente: ")),s("strong",null,l(n.asignacion?.docente?.nombre),1)])]),_:1})]),_:1}),e(y,{ref:"cardNotas",flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(w,{class:"row items-center"},{default:a(()=>[t[19]||(t[19]=s("div",{class:"text-subtitle1"},"Notas (SER · SABER · HACER · DECIDIR)",-1)),e(T),e(k,{flat:"",dense:"",icon:"refresh",onClick:r.cargarNotas,loading:n.loadingNotas},null,8,["onClick","loading"])]),_:1}),e(V,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:a(()=>[t[21]||(t[21]=s("thead",null,[s("tr",{class:"bg-grey-2"},[s("th",{class:"text-left"},"#"),s("th",{class:"text-left"},"Nombre"),s("th",{class:"text-right"},"SER (10)"),s("th",{class:"text-right"},"SABER (35)"),s("th",{class:"text-right"},"HACER (35)"),s("th",{class:"text-right"},"DECIDIR (10)"),s("th",{class:"text-right"},"TOTAL (90)")])],-1)),s("tbody",null,[r.rowsEstudiantes.length===0?(d(),f("tr",O,[s("td",W,[e(h,{name:"warning",class:"q-mr-sm"}),t[20]||(t[20]=c(" Sin estudiantes "))])])):C("",!0),(d(!0),f(R,null,N(r.rowsEstudiantes,(i,v)=>(d(),f("tr",{key:i.id},[s("td",null,l(v+1),1),s("td",null,l(i.nombre),1),s("td",Z,l(r.nota(i.id,"ser")),1),s("td",J,l(r.nota(i.id,"saber")),1),s("td",K,l(r.nota(i.id,"hacer")),1),s("td",X,l(r.nota(i.id,"decidir")),1),s("td",$,l(r.totalNota(i.id)),1)]))),128))])]),_:1})]),_:1},512),e(y,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(w,{class:"row q-col-gutter-md items-center"},{default:a(()=>[s("div",tt,[e(Q,{modelValue:n.desde,"onUpdate:modelValue":t[6]||(t[6]=i=>n.desde=i),label:"Desde (YYYY-MM-DD)",dense:"",outlined:"",mask:"date"},{prepend:a(()=>[e(h,{name:"event"})]),default:a(()=>[e(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(I,{modelValue:n.desde,"onUpdate:modelValue":t[5]||(t[5]=i=>n.desde=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),s("div",st,[e(Q,{modelValue:n.hasta,"onUpdate:modelValue":t[8]||(t[8]=i=>n.hasta=i),label:"Hasta (YYYY-MM-DD)",dense:"",outlined:"",mask:"date"},{prepend:a(()=>[e(h,{name:"event"})]),default:a(()=>[e(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(I,{modelValue:n.hasta,"onUpdate:modelValue":t[7]||(t[7]=i=>n.hasta=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),s("div",et,[e(k,{outline:"",color:"primary",label:"Actualizar resumen",onClick:r.cargarResumen,loading:n.loadingResumen},null,8,["onClick","loading"])])]),_:1})]),_:1}),e(V,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:a(()=>[t[23]||(t[23]=s("thead",null,[s("tr",{class:"bg-grey-2"},[s("th",{class:"text-left"},"#"),s("th",{class:"text-left"},"Nombre"),s("th",{class:"text-left"},"CI"),s("th",{class:"text-right"},"Presentes"),s("th",{class:"text-right"},"Tardes"),s("th",{class:"text-right"},"Ausentes"),s("th",{class:"text-right"},"Licencias"),s("th",{class:"text-right"},"Total"),s("th",{class:"text-right"},"% Asistencia")])],-1)),s("tbody",null,[r.rowsEstudiantes.length===0?(d(),f("tr",at,[s("td",ot,[e(h,{name:"warning",class:"q-mr-sm"}),t[22]||(t[22]=c(" Sin datos disponibles "))])])):C("",!0),(d(!0),f(R,null,N(r.rowsEstudiantes,(i,v)=>(d(),f("tr",{key:i.id},[s("td",null,l(v+1),1),s("td",null,l(i.nombre),1),s("td",null,l(i.ci),1),s("td",it,l(n.resumen[i.id]?.presentes??0),1),s("td",nt,l(n.resumen[i.id]?.tardes??0),1),s("td",lt,l(n.resumen[i.id]?.ausentes??0),1),s("td",rt,l(n.resumen[i.id]?.licencias??0),1),s("td",dt,l(n.resumen[i.id]?.total??0),1),s("td",ut,l(n.resumen[i.id]?.porcentaje??0)+"%",1)]))),128))])]),_:1})]))]),_:1})}const Rt=q(Y,[["render",ct]]);export{Rt as default};
